@model List<Final_Project.Controllers.MessageModel>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var currentUserId = Context.Session.GetInt32("MaTK");
}

<link rel="stylesheet" href="~/css/tinnhan.css">

<div class="chat-container" id="chatRight">
    <!-- Header -->
    <div class="chat-header">
        <a id="back_user_list" href="javascript:void(0)" class="back-btn">
            <i class="fas fa-chevron-left"></i>
        </a>
        <div class="chat-user-avatar">
            <img class="rounded-circle user_img" 
                 src="@Url.Content("~/images/AvatarAD.png")" 
                 alt="User Avatar">
        </div>
        <div class="chat-user-info">
            <span><strong id="receiver_name">Admin</strong></span>
            <p class="mb-0">Messages</p>
        </div>
    </div>

    <!-- Body -->
    <div class="chat-body chat-scroll">
        <ul class="messages-list">
            @foreach (var msg in Model)
            {
                bool isSent = msg.NguoiGuiId == currentUserId;
                string liClass = isSent ? "message sent" : "message received";

                string avatarSrc = msg.NguoiGuiId == 3
                    ? Url.Content("~/images/AvatarAD.png")
                    : (msg.NguoiGuiAvatar ?? Url.Content("~/Admin/img/default-avatar.png"));

                <li class="@liClass">
                    <div class="message-avatar">
                        <img src="@avatarSrc" alt="User Image" class="avatar-img rounded-circle">
                    </div>
                    <div class="message-content">
                        @if (!isSent)
                        {
                            <small class="sender-name">@msg.NguoiGuiHoTen</small>
                        }
                        <p>@msg.NoiDung</p>
                        <span class="message-time">@msg.ThoiGianGui.ToString("HH:mm")</span>
                    </div>
                </li>
            }
        </ul>
    </div>

    <!-- Footer -->
    <div class="chat-footer">
        <form asp-action="GuiTinNhan" method="post" class="chat-input-group">
            <input class="chat-input" placeholder="Type your message..." name="noiDung" required />
            <button class="chat-send-btn">
                <i class="fa fa-paper-plane" aria-hidden="true"></i>
            </button>
        </form>
    </div>
</div>
