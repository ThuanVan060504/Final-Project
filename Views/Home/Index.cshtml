<link rel="stylesheet" href="/css/videorv.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
@using Final_Project.Models.Shop
@model IEnumerable<SanPham>

@{

    ViewData["Title"] = "Sản phẩm nổi bật";
    var savedVoucherIds = (ViewBag.SavedVoucherIds as HashSet<int>) ?? new HashSet<int>();
    var usedVoucherIds = (ViewBag.UsedVoucherIds as HashSet<int>) ?? new HashSet<int>();
}


<style>
    .container .ps-section__content {
        min-height: 340px;
    }

    .ps-site-features {
        margin-top: 10px;
    }

    .col-md-3 {
        margin-bottom: 10px;
    }

    .suggestion-card {
        border: 1px solid #dee2e6 !important;
        margin-bottom: 1.5rem !important;
        text-align: center !important;
        border: 1px solid #dee2e6 !important;
        height: 48%;
    }

    img.suggestion-img {
        max-width: 182px;
    }

    .ps-deal-of-day {
        margin-top: 20px;
    }

    /* Thêm style cho voucher nếu cần */
    .voucher-item {
        display: inline-flex;
        align-items: center;
        margin-bottom: 15px;
        margin-right: 15px;
        padding: 12px;
        border-radius: 8px;
        background-color: #fff4eb;
        border: 2px solid #ff9933;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .voucher-image {
        flex-shrink: 0;
        margin-right: 15px; /* Khoảng cách sau ảnh */
    }

        .voucher-image img {
            width: 50px; /* size ảnh */
            height: 50px;
            border-radius: 4px;
        }

    /* === THAY ĐỔI LAYOUT === */
    .voucher-content {
        flex-grow: 0;
        margin-right: 15px;
    }

        .voucher-content p {
            margin: 0;
            line-height: 1.4;
        }

        .voucher-content .voucher-code {
            font-size: 1.1em;
            font-weight: 700;
            color: #d9534f; /* Màu ĐỎ CAM cho mã */
        }

        .voucher-content .voucher-desc {
            font-size: 0.9em;
            color: #555; /* Chữ xám đậm */
        }

    .voucher-action {
        margin-left: 0;
    }

    /* Đổi màu nút "Đã lưu" cho phù hợp */
    .btn-save-voucher.btn-success {
        background-color: #28a745;
        border-color: #28a745;
    }

    .btn-save-voucher.btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    .video-review-list .ps-product {
        border: none;
        background: none; /* Bỏ nền xám để card video tự xử lý */
    }

    .video-review-card {
        position: relative;
        cursor: pointer;
        border-radius: 8px;
        overflow: hidden;
        /* Kích thước giống TikTok/Shorts (tỷ lệ 9:16) */
        height: 320px;
        width: 180px; /* Cố định chiều rộng */
        margin: 0 auto; /* Căn giữa trong carousel item */
        background-color: #222; /* Màu nền khi ảnh chưa tải */
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

        .video-review-card .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Đảm bảo ảnh lấp đầy khung */
            transition: transform 0.3s ease;
        }

        .video-review-card:hover .video-thumbnail {
            transform: scale(1.05); /* Hiệu ứng zoom nhẹ */
        }

        .video-review-card .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 50px;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
            pointer-events: none; /* Tránh icon cản click */
        }

        .video-review-card:hover .play-icon {
            color: rgba(255, 255, 255, 1);
            transform: translate(-50%, -50%) scale(1.1);
        }

    .video-product-info {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 10px;
        /* Lớp phủ mờ ở dưới để đọc chữ rõ hơn */
        background: linear-gradient(0deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
        color: #fff;
    }

        .video-product-info .video-title {
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; /* Dấu ... nếu tên video quá dài */
        }

        .video-product-info .product-link {
            font-size: 0.85em;
            color: #f0f0f0;
            text-decoration: none;
            display: block;
            padding: 4px 0;
            border-radius: 4px;
            transition: background-color 0.2s;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; /* Dấu ... nếu tên SP quá dài */
        }

            .video-product-info .product-link:hover {
                color: #fff;
                text-decoration: underline;
            }


    /* =================================== */
    /*  CSS MỚI CHO VIDEO MODAL */
    /* =================================== */
    #videoReviewModal .modal-lg {
        max-width: 400px; /* Chiều rộng giống điện thoại */
        margin: 1.75rem auto;
    }

    #videoReviewModal .modal-content {
        background-color: #000;
        border: none;
        border-radius: 10px;
        overflow: hidden; /* Đảm bảo video bo góc theo modal */
    }

    #videoReviewModal .modal-body {
        padding: 0;
        /* Giữ tỷ lệ khung hình video */
        position: relative;
        /* Tỷ lệ 16:9 (9 / 16 * 100 = 56.25%) */
        /* Nếu video của bạn là dọc (9:16) thì dùng padding-bottom: 177.77% */
        padding-bottom: 177.77%;
        height: 0;
        overflow: hidden;
    }

    #videoReviewModal #videoPlayer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        background-color: #000;
    }

    #videoReviewModal .modal-header {
        border-bottom: none;
        position: absolute;
        top: 5px;
        right: 5px;
        z-index: 1056; /* Phải cao hơn video */
    }

    #videoReviewModal .btn-close {
        background-color: rgba(255,255,255,0.7);
        border-radius: 50%;
        padding: 0.5em;
        opacity: 0.8;
    }

        #videoReviewModal .btn-close:hover {
            opacity: 1;
        }

    /* CSS for video modal navigation */
    .modal-video-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(0, 0, 0, 0.3);
        color: white;
        border: none;
        font-size: 2rem;
        padding: 5px;
        cursor: pointer;
        z-index: 1057;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        transition: background-color 0.2s ease;
    }

        .modal-video-nav.prev {
            left: 15px;
        }

        .modal-video-nav.next {
            right: 15px;
        }

        .modal-video-nav:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }
    /* =================================== */
    /* CSS MỚI CHO VIDEO MODAL (SWIPER)  */
    /* =================================== */
    #videoReviewModal .modal-lg {
        max-width: 400px; /* Chiều rộng giống điện thoại */
        margin: 1.75rem auto;
        height: 85vh; /* Chiều cao tối đa */
    }

    #videoReviewModal .modal-content {
        background-color: #000;
        border: none;
        border-radius: 10px;
        overflow: hidden;
        height: 100%; /* Cho phép nội dung bên trong chiếm full chiều cao */
    }

    #videoReviewModal .modal-body {
        padding: 0;
        height: 100%;
        position: relative;
    }

    /* CSS cho Swiper */
    #videoSwiper {
        width: 100%;
        height: 100%;
    }

    .swiper-slide {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #000;
    }

        .swiper-slide .video-player-slide {
            width: 100%;
            height: 100%;
            object-fit: contain; /* 'contain' để video không bị cắt, 'cover' nếu muốn lấp đầy */
        }

    /* CSS cho thông tin trên video */
    .video-slide-info {
        position: absolute;
        bottom: 20px;
        left: 15px;
        right: 15px;
        z-index: 10;
        color: #fff;
        text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        background: linear-gradient(0deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 100%);
        padding: 10px;
        border-radius: 5px;
    }

        .video-slide-info h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .video-slide-info .product-link {
            color: #f0f0f0;
            text-decoration: none;
            font-size: 0.9em;
        }

            .video-slide-info .product-link:hover {
                color: #fff;
                text-decoration: underline;
            }


    /* Nút đóng modal */
    #videoReviewModal .modal-header {
        border-bottom: none;
        position: absolute;
        top: 5px;
        right: 5px;
        z-index: 1056; /* Phải cao hơn video */
    }

    #videoReviewModal .btn-close {
        background-color: rgba(255,255,255,0.7);
        border-radius: 50%;
        padding: 0.5em;
        opacity: 0.8;
    }

    /* Xóa CSS cho nút .modal-video-nav cũ nếu có */
    .modal-video-nav {
        display: none !important;
    }
    /* End of CSS for video modal navigation */

    /* =================================== */
/* CSS CHO CARD CHI TIẾT SẢN PHẨM   */
/* =================================== */

/* Lớp phủ chi tiết sản phẩm (ẩn mặc định) */
.video-product-details {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 20; /* Cao hơn video-slide-info (thường z-index: 10) */
    background-color: rgba(25, 25, 25, 0.95); /* Nền mờ đục */
    
    /* Hiệu ứng kính mờ (Tùy chọn) */
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    padding: 15px;
    color: #fff;
    
    /* Ẩn đi (dịch chuyển xuống dưới) */
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    visibility: hidden;
}

/* Lớp .show để hiện card */
.video-product-details.show {
    transform: translateY(0);
    visibility: visible;
}

/* Nút đóng card chi tiết */
.btn-close-details {
    position: absolute;
    top: 10px;
    right: 15px;
    background: rgba(255,255,255,0.2);
    border: none;
    color: #fff;
    font-size: 1.5rem;
    line-height: 1;
    padding: 0 8px 3px 8px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 25;
}
.btn-close-details:hover {
    background: rgba(255,255,255,0.4);
}

/* Layout bên trong card */
.product-info-header {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
}

.product-details-img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    margin-right: 15px;
    border: 1px solid rgba(255,255,255,0.1);
}

.product-info-price .price {
    font-size: 1.3em;
    font-weight: 700;
    color: #ff5722; /* Màu cam nổi bật */
}

.product-details-name {
    font-size: 1em;
    font-weight: 600;
    margin-bottom: 15px;
    /* Cắt chữ nếu quá dài */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Nút bấm */
.btn-add-to-cart, .btn-full-details {
    display: block;
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    font-weight: 600;
    font-size: 0.95em;
    margin-bottom: 10px;
    text-decoration: none;
    border: none;
    cursor: pointer;
}

.btn-add-to-cart {
    background-color: #e74c3c; /* Màu đỏ */
    color: #fff;
}
.btn-add-to-cart:hover {
    background-color: #c0392b;
}

.btn-full-details {
    background-color: rgba(255, 255, 255, 0.2);
    color: #fff;
}
.btn-full-details:hover {
    background-color: rgba(255, 255, 255, 0.3);
    color: #fff;
}
</style>


<div class="container mt-4">
    <div class="row">
        <div class="col-md-3">
            <ul class="list-group">
                <li class="list-group-item"><a href="/products/sofa" class="text-decoration-none text-dark">Sofa & Ghế</a></li>
                <li class="list-group-item"><a href="/products/ban" class="text-decoration-none text-dark">Bàn Ăn & Bàn Làm Việc</a></li>
                <li class="list-group-item"><a href="/products/tu-ke" class="text-decoration-none text-dark">Tủ & Kệ</a></li>
                <li class="list-group-item"><a href="/products/giuong" class="text-decoration-none text-dark">Giường & Nệm</a></li>
                <li class="list-group-item"><a href="/products/den" class="text-decoration-none text-dark">Đèn Trang Trí</a></li>
                <li class="list-group-item"><a href="/products/rem-tham" class="text-decoration-none text-dark">Rèm Cửa & Thảm</a></li>
                <li class="list-group-item"><a href="/products/trang-tri-tuong" class="text-decoration-none text-dark">Trang Trí Tường</a></li>
                <li class="list-group-item"><a href="/products/nha-bep" class="text-decoration-none text-dark">Dụng Cụ Nhà Bếp</a></li>
                <li class="list-group-item"><a href="/products/chan-ga-goi" class="text-decoration-none text-dark">Chăn Ga Gối Nệm</a></li>
                <li class="list-group-item"><a href="/products/ngoai-troi" class="text-decoration-none text-dark">Đồ Nội Thất Ngoài Trời</a></li>
                <li class="list-group-item"><a href="/products/phu-kien" class="text-decoration-none text-dark">Phụ Kiện Trang Trí</a></li>
            </ul>
        </div>
        <style>
            .custom-carousel .carousel-item img {
                transition: transform 1s ease, opacity 1s ease; /* chuyển sang 3s */
            }

            .custom-carousel .carousel-item {
                height: 300px; /* Chiều cao cố định nếu muốn */
                overflow: hidden;
            }

                .custom-carousel .carousel-item img {
                    object-fit: cover; /* Đảm bảo ảnh đầy đủ và không bị biến dạng */
                    width: 100%;
                    height: 100%;
                }

            .custom-prev, .custom-next {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                background-color: rgba(0,0,0,0.5);
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 10;
            }

            .custom-prev {
                left: 10px;
            }

            .custom-next {
                right: 10px;
            }

            .custom-prev-icon, .custom-next-icon {
                color: #fff;
                font-size: 24px;
                line-height: 1;
            }

        </style>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <div class="col-md-6">
            <div id="mainCarousel" class="carousel slide mb-3" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="https://rubicmarketing.com/wp-content/uploads/2021/09/thiet-ke-banner-quang-cao-noi-that-3.jpg" class="d-block w-100 rounded" alt="Slide 1">
                    </div>
                    <div class="carousel-item">
                        <img src="https://noithatzear.vn/wp-content/uploads/2023/09/Mau-banner-noi-that-danh-cho-cong-ty.png" class="d-block w-100 rounded" alt="Slide 2">
                    </div>
                    <div class="carousel-item">
                        <img src="https://noithatzear.vn/wp-content/uploads/2023/09/Mau-banner-noi-that-dep.png" class="d-block w-100 rounded" alt="Slide 3">
                    </div>
                    <div class="carousel-item">
                        <img src="https://noithatzear.vn/wp-content/uploads/2023/09/Banner-noi-that.png" class="d-block w-100 rounded" alt="Slide 4">
                    </div>
                </div>
                <button class="custom-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
                    <span class="custom-prev-icon" aria-hidden="true">&#10094;</span>
                    <span class="visually-hidden"></span>
                </button>
                <button class="custom-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
                    <span class="custom-next-icon" aria-hidden="true">&#10095;</span>
                    <span class="visually-hidden"></span>
                </button>

            </div>

            <div class="row">
                <div class="col-4">
                    <div class="bg-white border text-center p-2 mb-2">
                        <small>UP TO 30% OFF</small><br />
                        <img src="https://i.pinimg.com/736x/6b/81/3f/6b813ff256e49639e8e85f254d296807.jpg" alt="Promo 1" class="promo-img img-fluid" />
                        <p>For all hand purses</p>
                    </div>
                </div>
                <div class="col-4">
                    <div class="bg-white border text-center p-2 mb-2">
                        <small>EXPLORE THE BIGGEST</small><br />
                        <img src="https://i.pinimg.com/1200x/09/d4/ab/09d4ab5fa1e729587c0526567f9f42a7.jpg" alt="Promo 2" class="promo-img img-fluid" />
                        <p>Time Zone</p>
                    </div>
                </div>
                <div class="col-4">
                    <div class="bg-white border text-center p-2 mb-2">
                        <small>DON’T MISS THE YEAR</small><br />
                        <img src="https://i.pinimg.com/1200x/4d/d7/ab/4dd7abbcf183a108ccd041879c931df6.jpg" alt="Promo 3" class="promo-img img-fluid" />
                        <p>7 days left</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar-suggestions col-md-3">
            <div class="suggestion-card">
                <small class="suggestion-title">Recently Viewed</small><br />
                <img src="https://i.pinimg.com/1200x/ee/16/29/ee1629f6518a827c1dbc88e1d4315118.jpg"
                     alt="Recently Viewed"
                     class="suggestion-img" />
                <p class="suggestion-link">
                    <a href="#">See your browsing history</a>
                </p>
            </div>

            <div class="suggestion-card">
                <small class="suggestion-title">Suggestions for You</small><br />
                <img src="https://i.pinimg.com/1200x/05/ac/d3/05acd3cdde303e1e9b0f60fd73dcab40.jpg"
                     alt="Suggestions"
                     class="suggestion-img" />
                <p class="suggestion-link">
                    <a href="#">Watch more</a>
                </p>
            </div>
        </div>

    </div>
</div>

<div class="container mt-4">
    @if (ViewBag.AvailableVouchers != null)
    {
        <h3> Voucher ưu đãi </h3>
        <div class="voucher-list">
            @foreach (var voucher in (List<Voucher>)ViewBag.AvailableVouchers)
            {
                <div class="voucher-item" style="margin-right: 15px;">

                    <div class="voucher-image">
                        <img src="~/images/G3TD_Ship.png" alt="Voucher">
                    </div>

                    <div class="voucher-content">
                        <p class="voucher-code">@voucher.MaCode</p>
                        <p class="voucher-desc">
                            @voucher.MoTa - HSD: @voucher.NgayKetThuc.ToString("dd/MM/yyyy")
                        </p>
                    </div>

                    <div class="voucher-action">
                        @if (usedVoucherIds.Contains(voucher.MaVoucherID))
                        {
                            <button class="btn btn-dark btn-sm" disabled>Đã sử dụng</button>
                        }
                        else if (savedVoucherIds.Contains(voucher.MaVoucherID))
                        {
                            <button class="btn btn-secondary btn-sm" disabled>Đã lưu</button>
                        }
                        else
                        {
                            <button class="btn btn-danger btn-sm btn-save-voucher" data-id="@voucher.MaVoucherID">Lưu</button>
                        }
                    </div>
                </div>
            }
        </div>
    }
</div>
<hr />
<div class="ps-site-features">
    <div class="ps-container">
        <div class="ps-block--site-features">
            <div class='ps-block__item'>
                <div class='ps-block__left'>
                    <i class='icon-rocket'></i>
                </div>
                <div class='ps-block__right'>
                    <h4> Miễn phí vận chuyển</h4>
                    <p>
                        cho đơn hàng từ 10.000.000 Vnđ
                    </p>
                </div>
            </div>
            <div class='ps-block__item'>
                <div class='ps-block__left'>
                    <i class='icon-sync'></i>
                </div>
                <div class='ps-block__right'>
                    <h4>Lịch sử đơn hàng</h4>
                    <p>
                        Trạng thái Đơn Hàng
                    </p>
                </div>
            </div>
            <div class='ps-block__item'>
                <div class='ps-block__left'>
                    <i class='icon-credit-card'></i>
                </div>
                <div class='ps-block__right'>
                    <h4> Thanh toán an toàn</h4>
                    <p>
                        Thanh toán 100% an toàn
                    </p>
                </div>
            </div>
            <div class='ps-block__item'>
                <div class='ps-block__left'>
                    <i class='icon-bubbles'></i>
                </div>
                <div class='ps-block__right'>
                    <h4> Hỗ trợ 24/7</h4>
                    <p>
                        Hỗ trợ riêng dành cho bạn
                    </p>
                </div>
            </div>
            <div class='ps-block__item'>
                <div class='ps-block__left'>
                    <i class='icon-gift'></i>
                </div>
                <div class='ps-block__right'>
                    <h4>Dịch vụ quà tặng</h4>
                    <p>
                        Hỗ trợ dịch vụ quà tặng
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

@if (ViewBag.VideoList != null && ((List<Video>)ViewBag.VideoList).Any())
{
    <div class="ps-product-list video-review-list">
        <div class="ps-container">
            <div class="ps-section__header">
                <h3>🎬 Video Review Sản Phẩm</h3>
                <a class="d-none d-sm-block" href="#">Xem tất cả</a>
            </div>
            <div class="ps-section__content">
                <div class="ps-carousel--nav owl-slider"
                     data-owl-auto="false"
                     data-owl-loop="false"
                     data-owl-speed="10000"
                     data-owl-gap="20"
                     data-owl-nav="true"
                     data-owl-dots="true"
                     data-owl-item="7"
                     data-owl-item-xs="2"
                     data-owl-item-sm="3"
                     data-owl-item-md="4"
                     data-owl-item-lg="5"
                     data-owl-item-xl="6"
                     data-owl-duration="1000"
                     data-owl-mousedrag="on">

                    @foreach (var video in (List<Video>)ViewBag.VideoList)
                    {
                        <div class="ps-product">
                            <div class="video-review-card" data-video-src="@video.VideoUrl">
                                <img src="@(video.ThumbnailUrl ?? "/images/no-image.png")" alt="@video.TieuDe" class="video-thumbnail" />
                                <i class="fa fa-play play-icon"></i>
                                <div class="video-product-info">
                                    <div class="video-title">@video.TieuDe</div>
                                    @if (video.SanPham != null)
                                    {
                                        <a href="@Url.Action("Details", "SanPham", new { id = video.MaSP })" class="product-link" onclick="event.stopPropagation();">
                                            <i class="fa fa-tag"></i> @video.SanPham.TenSP
                                        </a>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
}
<div class="ps-deal-of-day">
    <div class="ps-container">
        <div class="ps-section__header">
            <div class="ps-block--countdown-deal">
                <div class="ps-block__left">
                    <h3>Khuyến mãi đã hết hạn</h3>
                </div>
                <div class="ps-block__right">
                    <figure>
                        <figcaption></figcaption>
                        <span style="display:none" id="berakhir">0:12:40:44</span>
                        <ul class="ps-countdown d-none d-sm-block" data-time="">
                            <li><span class="days"></span> Ngày</li>
                            <li><span class="hours"></span> Giờ</li>
                            <li><span class="minutes"></span> Phút</li>
                            <li><span class="seconds"></span> Giây</li>
                        </ul>
                        <ul class="ps-countdown d-block d-sm-none" data-time="">
                            <li><span class="days"></span> Ngày</li>
                            <li><span class="hours"></span> Giờ</li>
                            <li><span class="minutes"></span> Phút</li>
                            <li><span class="seconds"></span></li>
                        </ul>

                    </figure>
                </div>
            </div>
            <a class="d-none d-sm-block" href="#">Tại Đây</a>
        </div>

        <div class="ps-section__content">
            <div class="ps-carousel--nav owl-slider"
                 data-owl-auto="false"
                 data-owl-loop="false"
                 data-owl-speed="10000"
                 data-owl-gap="30"
                 data-owl-nav="true"
                 data-owl-dots="true"
                 data-owl-item="7"
                 data-owl-item-xs="2"
                 data-owl-item-sm="3"
                 data-owl-item-md="4"
                 data-owl-item-lg="5"
                 data-owl-item-xl="6"
                 data-owl-duration="1000"
                 data-owl-mousedrag="on">

                @foreach (var sp in Model)
                {
                    <div class="ps-product ps-product--inner">
                        <div class="ps-product__thumbnail">
                            <a href="/SanPham/Details/@sp.MaSP">
                                <img src="@sp.ImageURL" alt="@sp.TenSP" />
                            </a>
                            @if (sp.SoLuong == 0)
                            {
                                <div class="ps-product__badge out-stock">Habis Terjual</div>
                            }
                            <ul class="ps-product__actions">
                                <li><a href="#" data-toggle="tooltip" title="Read More"><i class="icon-bag2"></i></a></li>
                                <li><a href="#" data-toggle="tooltip" title="Quick View" class="quick_view" data-id="@sp.MaSP"><i class="icon-eye"></i></a></li>
                                <li><a data-toggle="tooltip" title="Add to Whishlist" id="save-@sp.MaSP"><i class="icon-heart" onclick="save('@sp.MaSP', this.id)"></i></a></li>
                            </ul>
                        </div>
                        <div class="ps-product__container">
                            <p class="ps-product__price sale">
                                @String.Format("{0:N0}", sp.DonGia) đ
                            </p>
                            <div class="ps-product__content">
                                <a class="ps-product__title" href="/SanPham/Details/@sp.MaSP">@sp.TenSP</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<script src="~/js/owl.carousel.min.js"></script>
<script>
    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>

<script>
    $(document).ready(function() {

        // --- Code cho Voucher ---
        $('.btn-save-voucher').on('click', function(e) {
            e.preventDefault();
            var voucherId = $(this).data('id');
            var button = $(this);

            $.ajax({
                url: '/api/voucher/save',
                type: 'POST',
                data: { voucherId: voucherId },
                success: function(response) {
                    alert(response.message);
                    button.text('Đã lưu').prop('disabled', true).removeClass('btn-danger').addClass('btn-success');
                },
                error: function(xhr) {
                    var errorMsg = "Đã xảy ra lỗi. Vui lòng thử lại.";
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        errorMsg = xhr.responseJSON.message;
                    }
                    alert(errorMsg);

                    if(xhr.status == 409) { // 409 = Conflict (Đã lưu rồi)
                         button.text('Đã lưu').prop('disabled', true).removeClass('btn-danger').addClass('btn-secondary');
                    }
                }
            });
        });

// --- ✅ BẮT ĐẦU: SCRIPT MỚI CHO VIDEO REVIEW (DÙNG SWIPER) ---
        
        var $videoModal = $('#videoReviewModal');
        var videoCards = $('.video-review-card');
        var videoSwiperInstance = null; // Biến để giữ thể hiện (instance) của Swiper
        var clickedVideoIndex = 0; // Biến để lưu trữ index của video được click

        // Hàm để dừng tất cả video đang phát
        function pauseAllVideos() {
            $('#videoSwiper .swiper-slide video').each(function() {
                this.pause();
            });
        }
        
        // --- ⭐ MỚI: Hàm ẩn tất cả các card chi tiết sản phẩm ---
        function hideAllProductDetails() {
            $videoModal.find('.video-product-details').removeClass('show');
        }

        // Khi click vào một card video
        videoCards.on('click', function () {
            clickedVideoIndex = videoCards.index(this); // Lấy index của card được click
            $videoModal.modal('show'); // Hiển thị modal
        });

        // Sự kiện khi modal ĐÃ ĐƯỢC HIỂN THỊ
        $videoModal.on('shown.bs.modal', function () {
            // Khởi tạo Swiper
            videoSwiperInstance = new Swiper('#videoSwiper', {
                // Tùy chọn Swiper
                direction: 'vertical', // Quan trọng: cuộn dọc
                loop: false,
                mousewheel: true, // Cho phép cuộn bằng chuột
                initialSlide: clickedVideoIndex, // Bắt đầu tại video đã click

                // Sự kiện
                on: {
                    // Khi khởi tạo xong
                    init: function () {
                        // Tự động phát video đầu tiên (video được click)
                        var activeSlideVideo = $(this.slides[this.activeIndex]).find('video');
                        if (activeSlideVideo.length > 0) {
                            activeSlideVideo[0].play().catch(error => console.log("Lỗi tự động phát:", error));
                        }
                    },
                    // Khi chuyển slide xong
                    slideChangeTransitionEnd: function () {
                        // Dừng tất cả các video
                        pauseAllVideos();
                        
                        // --- ⭐ MỚI: Ẩn card SP khi chuyển slide ---
                        hideAllProductDetails(); 

                        // Phát video ở slide hiện tại
                        var activeSlideVideo = $(this.slides[this.activeIndex]).find('video');
                        if (activeSlideVideo.length > 0) {
                            activeSlideVideo[0].currentTime = 0; // Tua về đầu
                            activeSlideVideo[0].play().catch(error => console.log("Lỗi tự động phát:", error));
                        }
                    },

                    // --- ⭐ MỚI: Xử lý TAP (chạm/click) trên video ---
                    tap: function(swiper, event) {
                        // 1. Nếu click vào nút "Xem SP" hoặc "Card SP", thì bỏ qua (vì đã có handler riêng)
                        if ($(event.target).closest('.btn-show-product, .video-product-details').length) {
                             return;
                        }
                        
                        // 2. Nếu card SP đang mở, thì đóng nó lại
                        if ($videoModal.find('.video-product-details.show').length > 0) {
                            hideAllProductDetails();
                            // và tiếp tục phát video
                            var currentVideo = $(swiper.slides[swiper.activeIndex]).find('video');
                            if (currentVideo.length > 0) currentVideo[0].play();
                            return;
                        }

                        // 3. Ngược lại, xử lý play/pause video
                        var activeSlideVideo = $(swiper.slides[swiper.activeIndex]).find('video');
                        if (activeSlideVideo.length > 0) {
                            if (activeSlideVideo[0].paused) {
                                activeSlideVideo[0].play().catch(error => console.log("Lỗi play:", error));
                            } else {
                                activeSlideVideo[0].pause();
                            }
                        }
                    }
                },
            });
        });

        // Sự kiện khi modal BỊ ĐÓNG
        $videoModal.on('hidden.bs.modal', function () {
            // Dừng tất cả video
            pauseAllVideos();
            
            // --- ⭐ MỚI: Ẩn card SP khi đóng modal ---
            hideAllProductDetails(); 
            
            // Hủy Swiper instance để giải phóng tài nguyên
            if (videoSwiperInstance) {
                videoSwiperInstance.destroy(true, true);
                videoSwiperInstance = null;
            }
        });

        // --- ⭐ MỚI: DÙNG EVENT DELEGATION ĐỂ XỬ LÝ CLICK TRONG MODAL ---
        
        // Khi click nút "Xem sản phẩm"
        $videoModal.on('click', '.btn-show-product', function() {
            var productId = $(this).data('product-id');
            var $detailsCard = $('#product-details-' + productId);
            
            // Ẩn các card khác (nếu có) và hiển thị card này
            hideAllProductDetails();
            $detailsCard.addClass('show');

            // Tạm dừng video đang phát
            $(this).closest('.swiper-slide').find('video')[0].pause();
        });

        // Khi click nút "Đóng" (dấu X) trên card chi tiết
        $videoModal.on('click', '.btn-close-details', function() {
            $(this).closest('.video-product-details').removeClass('show');

            // Tiếp tục phát video (nếu Swiper còn tồn tại)
            if (videoSwiperInstance) {
                var activeSlideVideo = $(videoSwiperInstance.slides[videoSwiperInstance.activeIndex]).find('video');
                if (activeSlideVideo.length > 0) {
                    activeSlideVideo[0].play().catch(error => console.log("Lỗi play:", error));
                }
            }
        });
        
        // Khi click nút "Thêm vào giỏ hàng" (ví dụ)
        $videoModal.on('click', '.btn-add-to-cart', function(e) {
            e.preventDefault(); // Ngăn hành vi mặc định
            var productId = $(this).data('product-id');
            
            // --- !!! BẠN SẼ CODE LOGIC AJAX TẠI ĐÂY !!! ---
            alert('Đã thêm sản phẩm ' + productId + ' vào giỏ!');
            
            // Ví dụ:
            // $.ajax({
            //     url: '/Cart/AddToCart',
            //     type: 'POST',
            //     data: { id: productId, quantity: 1 },
            //     success: function(response) {
            //         alert('Thêm vào giỏ hàng thành công!');
            //         // Cập nhật icon giỏ hàng...
            //     },
            //     error: function() {
            //         alert('Có lỗi xảy ra!');
            //     }
            // });

            // Tùy chọn: đóng card sau khi thêm
            // $(this).closest('.video-product-details').removeClass('show');
        });

        // --- ✅ KẾT THÚC: SCRIPT MỚI CHO VIDEO REVIEW ---
 });
</script>
<div class="ps-home-ads">
    <div class="ps-container">
        <div class="row">
            <div class='col-xl-4 col-lg-4 col-md-12 col-sm-12 col-12 '>
                <a class='ps-collection' href='#' target='_blank'><img src='~/Users/img//3.jpg' alt='Home - Iklan Home No 3' /></a>
            </div>
            <div class='col-xl-4 col-lg-4 col-md-12 col-sm-12 col-12 '>
                <a class='ps-collection' href='#' target='_blank'><img src='~/Users/img//2.jpg' alt='Home - Iklan Home No 2' /></a>
            </div>
            <div class='col-xl-4 col-lg-4 col-md-12 col-sm-12 col-12 '>
                <a class='ps-collection' href='#' target='_blank'><img src='~/Users/img//1.jpg' alt='Home - Iklan Home No 1' /></a>
            </div>
        </div>
    </div>
</div>

<div class="ps-product-list ps-clothings">
    <div class="ps-container">
        <div class="ps-section__header">
            <h3>Sản phẩm mới nhất</h3>
        </div>
        <div class="ps-section__content">
            <div class="ps-carousel--nav owl-slider"
                 data-owl-auto="false" data-owl-loop="false" data-owl-speed="10000"
                 data-owl-gap="0" data-owl-nav="true" data-owl-dots="true"
                 data-owl-item="7" data-owl-item-xs="2" data-owl-item-sm="2"
                 data-owl-item-md="3" data-owl-item-lg="4" data-owl-item-xl="6"
                 data-owl-duration="1000" data-owl-mousedrag="on">

                @foreach (var sp in Model)
                {
                    <div class="ps-product">
                        <div class="ps-product__thumbnail">
                            <a asp-controller="SanPham" asp-action="Details" asp-route-id="@sp.MaSP">
                                <img src="@(!string.IsNullOrEmpty(sp.ImageURL) ? sp.ImageURL : "/images/no-image.png")" alt="@sp.TenSP" />
                            </a>
                            <ul class="ps-product__actions">
                                <li><a href="#"><i class="icon-bag2"></i></a></li>
                                <li><a class="quick_view" data-id="@sp.MaSP"><i class="icon-eye"></i></a></li>
                                <li><a id="save-@sp.MaSP"><i class="icon-heart" onclick="save('@sp.MaSP', this.id)"></i></a></li>
                            </ul>
                        </div>
                        <div class="ps-product__container">
                            <a class="ps-product__vendor" href="#">@sp.DanhMuc?.TenDanhMuc</a>
                            <div class="ps-product__content">
                                <a class="ps-product__title" href="#">@sp.TenSP</a>
                                <p class="ps-product__price sale">@sp.DonGia.ToString("N0") đ</p>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div class="ps-product-list ps-clothings">
    <div class="ps-container">
        <div class="ps-section__header">
            <h3>Sản phẩm được yêu thích</h3>
        </div>
        <div class="ps-section__content">
            <div class="ps-carousel--nav owl-slider"
                 data-owl-auto="false" data-owl-loop="false" data-owl-speed="10000"
                 data-owl-gap="0" data-owl-nav="true" data-owl-dots="true"
                 data-owl-item="7" data-owl-item-xs="2" data-owl-item-sm="2"
                 data-owl-item-md="3" data-owl-item-lg="4" data-owl-item-xl="6"
                 data-owl-duration="1000" data-owl-mousedrag="on">

                @if (ViewBag.SanPhamYeuThich != null)
                {
                    foreach (var item in ViewBag.SanPhamYeuThich)
                    {
                        var sp = item.SanPham as Final_Project.Models.Shop.SanPham;
                        int yeuThich = item.SoLuongYeuThich;
                        <div class="ps-product">
                            <div class="ps-product__thumbnail">
                                <a asp-controller="SanPham" asp-action="Details" asp-route-id="@sp.MaSP">
                                    <img src="@(!string.IsNullOrEmpty(sp.ImageURL) ? sp.ImageURL : "/images/no-image.png")" alt="@sp.TenSP" />
                                </a>
                                <ul class="ps-product__actions">
                                    <li><a href="#"><i class="icon-bag2"></i></a></li>
                                    <li><a class="quick_view" data-id="@sp.MaSP"><i class="icon-eye"></i></a></li>
                                    <li><a id="save-@sp.MaSP"><i class="icon-heart" onclick="save('@sp.MaSP', this.id)"></i></a></li>
                                </ul>
                            </div>
                            <div class="ps-product__container">
                                <a class="ps-product__vendor" href="#">@sp.DanhMuc?.TenDanhMuc</a>
                                <div class="ps-product__content">
                                    <a class="ps-product__title" href="#">@sp.TenSP</a>
                                    <p class="ps-product__price sale">@sp.DonGia.ToString("N0") đ</p>
                                    <p><i class="fa fa-heart text-danger"></i> @yeuThich lượt yêu thích</p>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>

<div class="ps-product-list ps-clothings">
    <div class="ps-container">
        <div class="ps-section__header">
            <h3>Sản phẩm bán chạy</h3>
        </div>
        <div class="ps-section__content">
            <div class="ps-carousel--nav owl-slider"
                 data-owl-auto="false" data-owl-loop="false" data-owl-speed="10000"
                 data-owl-gap="0" data-owl-nav="true" data-owl-dots="true"
                 data-owl-item="7" data-owl-item-xs="2" data-owl-item-sm="2"
                 data-owl-item-md="3" data-owl-item-lg="4"
                 data-owl-item-xl="6"
                 data-owl-duration="1000"
                 data-owl-mousedrag="on">

                @if (ViewBag.SanPhamBanChay != null)
                {
                    foreach (var item in ViewBag.SanPhamBanChay)
                    {
                        var sp = item.SanPham as Final_Project.Models.Shop.SanPham;
                        int daBan = item.SoLuongDaBan;
                        <div class="ps-product">
                            <div class="ps-product__thumbnail">
                                <a asp-controller="SanPham" asp-action="Details" asp-route-id="@sp.MaSP">
                                    <img src="@(!string.IsNullOrEmpty(sp.ImageURL) ? sp.ImageURL : "/images/no-image.png")" alt="@sp.TenSP" />
                                </a>
                                <ul class="ps-product__actions">
                                    <li><a href="#"><i class="icon-bag2"></i></a></li>
                                    <li><a class="quick_view" data-id="@sp.MaSP"><i class="icon-eye"></i></a></li>
                                    <li><a id="save-@sp.MaSP"><i class="icon-heart" onclick="save('@sp.MaSP', this.id)"></i></a></li>
                                </ul>
                            </div>
                            <div class="ps-product__container">
                                <a class="ps-product__vendor" href="#">@sp.DanhMuc?.TenDanhMuc</a>
                                <div class="ps-product__content">
                                    <a class="ps-product__title" href="#">@sp.TenSP</a>
                                    <p class="ps-product__price sale">@sp.DonGia.ToString("N0") đ</p>
                                    <p><i class="fa fa-shopping-cart text-primary"></i> Đã bán: @daBan</p>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>



<div class="ps-popup" id="subscribe" data-time="500">
    <div class="ps-popup__content bg--cover" style="background-image: url('/Users/img/subscribe.png');">

        <a class="ps-popup__close" href="#"><i class="icon-cross"></i></a>
        <div id="mc_embed_shell">
            <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
            <style type="text/css">
                #mc_embed_signup {
                    background: #fff;
                    false;
                    clear: left;
                    font: 14px Helvetica,Arial,sans-serif;
                    width: 600px;
                }
                /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
                                           We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
            </style>
            <div id="mc_embed_signup">
                <form action="https://gmail.us3.list-manage.com/subscribe/post?u=9c6eed3e23e98dae8bdcb103b&amp;id=e3cae8dfec&amp;f_id=0076a9e1f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank">
                    <div id="mc_embed_signup_scroll">
                        <h2>Đăng ký nhận bảng </h2>
                        <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
                        <div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""></div>
                        <div id="mce-responses" class="clear foot">
                            <div class="response" id="mce-error-response" style="display: none;"></div>
                            <div class="response" id="mce-success-response" style="display: none;"></div>
                        </div>
                        <div aria-hidden="true" style="position: absolute; left: -5000px;">
                            /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
                            <input type="text" name="b_9c6eed3e23e98dae8bdcb103b_e3cae8dfec" tabindex="-1" value="">
                        </div>
                        <div class="optionalParent">
                            <div class="clear foot">
                                <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
                                <p style="margin: 0px auto;"><a href="http://eepurl.com/jrHX-c" title="Mailchimp - email marketing made easy and fun"><span style="display: inline-block; background-color: transparent; border-radius: 4px;"><img class="refferal_badge" src="https://digitalasset.intuit.com/render/content/dam/intuit/mc-fe/en_us/images/intuit-mc-rewards-text-dark.svg" alt="Intuit Mailchimp" style="width: 220px; height: 40px; display: flex; padding: 2px 0px; justify-content: center; align-items: center;"></span></a></p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">
                                                                                                                           (function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';fnames[6]='COMPANY';ftypes[6]='text';}(jQuery));var $mcj = jQuery.noConflict(true);
                                                                                                                               // SMS Phone Multi-Country Functionality
                                                                                                                               if(!window.MC) {
                                                                                                                                 window.MC = {};
                                                                                                                               }
                                                                                                                               window.MC.smsPhoneData = {
                                                                                                                                 defaultCountryCode: 'VN',
                                                                                                                                 programs: [],
                                                                                                                                 smsProgramDataCountryNames: []
                                                                                                                               };

                                                                                                                               function getCountryUnicodeFlag(countryCode) {
                                                                                                                                  return countryCode.toUpperCase().replace(/./g, (char) => String.fromCodePoint(char.charCodeAt(0) + 127397))
                                                                                                                               };

                                                                                                                               // HTML sanitization function to prevent XSS
                                                                                                                               function sanitizeHtml(str) {
                                                                                                                                 if (typeof str !== 'string') return '';
                                                                                                                                 return str
                                                                                                                                   .replace(/&/g, '&amp;')
                                                                                                                                   .replace(/</g, '&lt;')
                                                                                                                                   .replace(/>/g, '&gt;')
                                                                                                                                   .replace(/"/g, '&quot;')
                                                                                                                                   .replace(/'/g, '&#x27;')
                                                                                                                                   .replace(/\//g, '&#x2F;');
                                                                                                                               }

                                                                                                                               // URL sanitization function to prevent javascript: and data: URLs
                                                                                                                               function sanitizeUrl(url) {
                                                                                                                                 if (typeof url !== 'string') return '';
                                                                                                                                 const trimmedUrl = url.trim().toLowerCase();
                                                                                                                                 if (trimmedUrl.startsWith('javascript:') || trimmedUrl.startsWith('data:') || trimmedUrl.startsWith('vbscript:')) {
                                                                                                                                   return '#';
                                                                                                                                 }
                                                                                                                                 return url;
                                                                                                                               }

                                                                                                                               const getBrowserLanguage = () => {
                                                                                                                                 if (!window?.navigator?.language?.split('-')[1]) {
                                                                                                                                   return window?.navigator?.language?.toUpperCase();
                                                                                                                                 }
                                                                                                                                 return window?.navigator?.language?.split('-')[1];
                                                                                                                               };

                                                                                                                               function getDefaultCountryProgram(defaultCountryCode, smsProgramData) {
                                                                                                                                 if (!smsProgramData || smsProgramData.length === 0) {
                                                                                                                                   return null;
                                                                                                                                 }

                                                                                                                                 const browserLanguage = getBrowserLanguage();

                                                                                                                                 if (browserLanguage) {
                                                                                                                                   const foundProgram = smsProgramData.find(
                                                                                                                                     (program) => program?.countryCode === browserLanguage,
                                                                                                                                   );
                                                                                                                                   if (foundProgram) {
                                                                                                                                     return foundProgram;
                                                                                                                                   }
                                                                                                                                 }

                                                                                                                                 if (defaultCountryCode) {
                                                                                                                                   const foundProgram = smsProgramData.find(
                                                                                                                                     (program) => program?.countryCode === defaultCountryCode,
                                                                                                                                   );
                                                                                                                                   if (foundProgram) {
                                                                                                                                     return foundProgram;
                                                                                                                                   }
                                                                                                                                 }

                                                                                                                                 return smsProgramData[0];
                                                                                                                               }

                                                                                                                               function updateSmsLegalText(countryCode, fieldName) {
                                                                                                                                 if (!countryCode || !fieldName) {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 const programs = window?.MC?.smsPhoneData?.programs;
                                                                                                                                 if (!programs || !Array.isArray(programs)) {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 const program = programs.find(program => program?.countryCode === countryCode);
                                                                                                                                 if (!program || !program.requiredTemplate) {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 const legalTextElement = document.querySelector('#legal-text-' + fieldName);
                                                                                                                                 if (!legalTextElement) {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 // Remove HTML tags and clean up the text
                                                                                                                                 const divRegex = new RegExp('</?[div][^>]*>', 'gi');
                                                                                                                                 const fullAnchorRegex = new RegExp('<a.*?</a>', 'g');
                                                                                                                                 const anchorRegex = new RegExp('<a href="(.*?)" target="(.*?)">(.*?)</a>');

                                                                                                                                 const requiredLegalText = program.requiredTemplate
                                                                                                                                   .replace(divRegex, '')
                                                                                                                                   .replace(fullAnchorRegex, '')
                                                                                                                                   .slice(0, -1);

                                                                                                                                 const anchorMatches = program.requiredTemplate.match(anchorRegex);

                                                                                                                                 if (anchorMatches && anchorMatches.length >= 4) {
                                                                                                                                   // Create link element safely using DOM methods instead of innerHTML
                                                                                                                                   const linkElement = document.createElement('a');
                                                                                                                                   linkElement.href = sanitizeUrl(anchorMatches[1]);
                                                                                                                                   linkElement.target = sanitizeHtml(anchorMatches[2]);
                                                                                                                                   linkElement.textContent = sanitizeHtml(anchorMatches[3]);

                                                                                                                                   legalTextElement.textContent = requiredLegalText + ' ';
                                                                                                                                   legalTextElement.appendChild(linkElement);
                                                                                                                                   legalTextElement.appendChild(document.createTextNode('.'));
                                                                                                                                 } else {
                                                                                                                                   legalTextElement.textContent = requiredLegalText + '.';
                                                                                                                                 }
                                                                                                                               }

                                                                                                                               function generateDropdownOptions(smsProgramData) {
                                                                                                                                 if (!smsProgramData || smsProgramData.length === 0) {
                                                                                                                                   return '';
                                                                                                                                 }

                                                                                                                                 return smsProgramData.map(program => {
                                                                                                                                   const flag = getCountryUnicodeFlag(program.countryCode);
                                                                                                                                   const countryName = getCountryName(program.countryCode);
                                                                                                                                   const callingCode = program.countryCallingCode || '';
                                                                                                                                   // Sanitize all values to prevent XSS
                                                                                                                                   const sanitizedCountryCode = sanitizeHtml(program.countryCode || '');
                                                                                                                                   const sanitizedCountryName = sanitizeHtml(countryName || '');
                                                                                                                                   const sanitizedCallingCode = sanitizeHtml(callingCode || '');
                                                                                                                                   return '<option value="' + sanitizedCountryCode + '">' + sanitizedCountryName + ' ' + sanitizedCallingCode + '</option>';
                                                                                                                                 }).join('');
                                                                                                                               }

                                                                                                                               function getCountryName(countryCode) {
                                                                                                                                 if (window.MC?.smsPhoneData?.smsProgramDataCountryNames && Array.isArray(window.MC.smsPhoneData.smsProgramDataCountryNames)) {
                                                                                                                                   for (let i = 0; i < window.MC.smsPhoneData.smsProgramDataCountryNames.length; i++) {
                                                                                                                                     if (window.MC.smsPhoneData.smsProgramDataCountryNames[i].code === countryCode) {
                                                                                                                                       return window.MC.smsPhoneData.smsProgramDataCountryNames[i].name;
                                                                                                                                     }
                                                                                                                                   }
                                                                                                                                 }
                                                                                                                                 return countryCode;
                                                                                                                               }

                                                                                                                               function getDefaultPlaceholder(countryCode) {
                                                                                                                                 if (!countryCode || typeof countryCode !== 'string') {
                                                                                                                                   return '+1 000 000 0000'; // Default US placeholder
                                                                                                                                 }

                                                                                                                                 const mockPlaceholders = [
                                                                                                                                   {
                                                                                                                                 countryCode: 'US',
                                                                                                                                 placeholder: '+1 000 000 0000',
                                                                                                                                 helpText: 'Include the US country code +1 before the phone number',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'GB',
                                                                                                                                 placeholder: '+44 0000 000000',
                                                                                                                                 helpText: 'Include the GB country code +44 before the phone number',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'CA',
                                                                                                                                 placeholder: '+1 000 000 0000',
                                                                                                                                 helpText: 'Include the CA country code +1 before the phone number',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'AU',
                                                                                                                                 placeholder: '+61 000 000 000',
                                                                                                                                 helpText: 'Include the AU country code +61 before the phone number',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'DE',
                                                                                                                                 placeholder: '+49 000 0000000',
                                                                                                                                 helpText: 'Fügen Sie vor der Telefonnummer die DE-Ländervorwahl +49 ein',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'FR',
                                                                                                                                 placeholder: '+33 0 00 00 00 00',
                                                                                                                                 helpText: 'Incluez le code pays FR +33 avant le numéro de téléphone',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'ES',
                                                                                                                                 placeholder: '+34 000 000 000',
                                                                                                                                 helpText: 'Incluya el código de país ES +34 antes del número de teléfono',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'NL',
                                                                                                                                 placeholder: '+31 0 00000000',
                                                                                                                                 helpText: 'Voeg de NL-landcode +31 toe vóór het telefoonnummer',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'BE',
                                                                                                                                 placeholder: '+32 000 00 00 00',
                                                                                                                                 helpText: 'Incluez le code pays BE +32 avant le numéro de téléphone',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'CH',
                                                                                                                                 placeholder: '+41 00 000 00 00',
                                                                                                                                 helpText: 'Fügen Sie vor der Telefonnummer die CH-Ländervorwahl +41 ein',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'AT',
                                                                                                                                 placeholder: '+43 000 000 0000',
                                                                                                                                 helpText: 'Fügen Sie vor der Telefonnummer die AT-Ländervorwahl +43 ein',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'IE',
                                                                                                                                 placeholder: '+353 00 000 0000',
                                                                                                                                 helpText: 'Include the IE country code +353 before the phone number',
                                                                                                                               },
                                                                                                                               {
                                                                                                                                 countryCode: 'IT',
                                                                                                                                 placeholder: '+39 000 000 0000',
                                                                                                                                 helpText:
                                                                                                                                   'Includere il prefisso internazionale IT +39 prima del numero di telefono',
                                                                                                                               },
                                                                                                                                 ];

                                                                                                                                 const selectedPlaceholder = mockPlaceholders.find(function(item) {
                                                                                                                                   return item && item.countryCode === countryCode;
                                                                                                                                 });

                                                                                                                                 return selectedPlaceholder ? selectedPlaceholder.placeholder : mockPlaceholders[0].placeholder;
                                                                                                                               }

                                                                                                                               function updatePlaceholder(countryCode, fieldName) {
                                                                                                                                 if (!countryCode || !fieldName) {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 const phoneInput = document.querySelector('#mce-' + fieldName);
                                                                                                                                 if (!phoneInput) {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 const placeholder = getDefaultPlaceholder(countryCode);
                                                                                                                                 if (placeholder) {
                                                                                                                                   phoneInput.placeholder = placeholder;
                                                                                                                                 }
                                                                                                                               }

                                                                                                                               function updateCountryCodeInstruction(countryCode, fieldName) {
                                                                                                                                 updatePlaceholder(countryCode, fieldName);

                                                                                                                               }

                                                                                                                               function getDefaultHelpText(countryCode) {
                                                                                                                                 const mockPlaceholders = [
                                                                                                                                   {
                                                                                                                                     countryCode: 'US',
                                                                                                                                     placeholder: '+1 000 000 0000',
                                                                                                                                     helpText: 'Include the US country code +1 before the phone number',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'GB',
                                                                                                                                     placeholder: '+44 0000 000000',
                                                                                                                                     helpText: 'Include the GB country code +44 before the phone number',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'CA',
                                                                                                                                     placeholder: '+1 000 000 0000',
                                                                                                                                     helpText: 'Include the CA country code +1 before the phone number',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'AU',
                                                                                                                                     placeholder: '+61 000 000 000',
                                                                                                                                     helpText: 'Include the AU country code +61 before the phone number',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'DE',
                                                                                                                                     placeholder: '+49 000 0000000',
                                                                                                                                     helpText: 'Fügen Sie vor der Telefonnummer die DE-Ländervorwahl +49 ein',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'FR',
                                                                                                                                     placeholder: '+33 0 00 00 00 00',
                                                                                                                                     helpText: 'Incluez le code pays FR +33 avant le numéro de téléphone',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'ES',
                                                                                                                                     placeholder: '+34 000 000 000',
                                                                                                                                     helpText: 'Incluya el código de país ES +34 antes del número de teléfono',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'NL',
                                                                                                                                     placeholder: '+31 0 00000000',
                                                                                                                                     helpText: 'Voeg de NL-landcode +31 toe vóór het telefoonnummer',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'BE',
                                                                                                                                     placeholder: '+32 000 00 00 00',
                                                                                                                                     helpText: 'Incluez le code pays BE +32 avant le numéro de téléphone',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'CH',
                                                                                                                                     placeholder: '+41 00 000 00 00',
                                                                                                                                     helpText: 'Fügen Sie vor der Telefonnummer die CH-Ländervorwahl +41 ein',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'AT',
                                                                                                                                     placeholder: '+43 000 000 0000',
                                                                                                                                     helpText: 'Fügen Sie vor der Telefonnummer die AT-Ländervorwahl +43 ein',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'IE',
                                                                                                                                     placeholder: '+353 00 000 0000',
                                                                                                                                     helpText: 'Include the IE country code +353 before the phone number',
                                                                                                                                   },
                                                                                                                                   {
                                                                                                                                     countryCode: 'IT',
                                                                                                                                     placeholder: '+39 000 000 0000',
                                                                                                                                     helpText: 'Includere il prefisso internazionale IT +39 prima del numero di telefono',
                                                                                                                                   },
                                                                                                                                 ];

                                                                                                                                 if (!countryCode || typeof countryCode !== 'string') {
                                                                                                                                   return mockPlaceholders[0].helpText;
                                                                                                                                 }

                                                                                                                                 const selectedHelpText = mockPlaceholders.find(function(item) {
                                                                                                                                     return item && item.countryCode === countryCode;
                                                                                                                                   });

                                                                                                                                   return selectedHelpText ? selectedHelpText.helpText : mockPlaceholders[0].helpText;
                                                                                                                               }

                                                                                                                               function setDefaultHelpText(countryCode) {
                                                                                                                                 const helpTextSpan = document.querySelector('#help-text');
                                                                                                                                 if (!helpTextSpan) {
                                                                                                                                   return;
                                                                                                                                 }


                                                                                                                               }

                                                                                                                               function updateHelpTextCountryCode(countryCode, fieldName) {
                                                                                                                                 if (!countryCode || !fieldName) {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 setDefaultHelpText(countryCode);
                                                                                                                               }

                                                                                                                               function initializeSmsPhoneDropdown(fieldName) {
                                                                                                                                 if (!fieldName || typeof fieldName !== 'string') {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 const dropdown = document.querySelector('#country-select-' + fieldName);
                                                                                                                                 const displayFlag = document.querySelector('#flag-display-' + fieldName);

                                                                                                                                 if (!dropdown || !displayFlag) {
                                                                                                                                   return;
                                                                                                                                 }

                                                                                                                                 const smsPhoneData = window.MC?.smsPhoneData;
                                                                                                                                 if (smsPhoneData && smsPhoneData.programs && Array.isArray(smsPhoneData.programs)) {
                                                                                                                                   dropdown.innerHTML = generateDropdownOptions(smsPhoneData.programs);
                                                                                                                                 }

                                                                                                                                 const defaultProgram = getDefaultCountryProgram(smsPhoneData?.defaultCountryCode, smsPhoneData?.programs);
                                                                                                                                 if (defaultProgram && defaultProgram.countryCode) {
                                                                                                                                   dropdown.value = defaultProgram.countryCode;

                                                                                                                                   const flagSpan = displayFlag?.querySelector('#flag-emoji-' + fieldName);
                                                                                                                                   if (flagSpan) {
                                                                                                                                     flagSpan.textContent = getCountryUnicodeFlag(defaultProgram.countryCode);
                                                                                                                                     flagSpan.setAttribute('aria-label', sanitizeHtml(defaultProgram.countryCode) + ' flag');
                                                                                                                                   }

                                                                                                                                   updateSmsLegalText(defaultProgram.countryCode, fieldName);
                                                                                                                                   updatePlaceholder(defaultProgram.countryCode, fieldName);
                                                                                                                                   updateCountryCodeInstruction(defaultProgram.countryCode, fieldName);
                                                                                                                                 }


                                                                                                                                 var smsNotRequiredRemoveCountryCodeEnabled = true;
                                                                                                                                 var smsField = Object.values({"EMAIL":{"name":"EMAIL","label":"Email Address","helper_text":"","type":"email","required":true,"audience_field_name":"Email Address","merge_id":0,"help_text_enabled":false,"enabled":true,"order":"0","field_type":"merge"},"FNAME":{"name":"FNAME","label":"First Name","helper_text":"","type":"text","required":false,"audience_field_name":"First Name","enabled":false,"order":null,"field_type":"merge","merge_id":1},"LNAME":{"name":"LNAME","label":"Last Name","helper_text":"","type":"text","required":false,"audience_field_name":"Last Name","enabled":false,"order":null,"field_type":"merge","merge_id":2},"ADDRESS":{"name":"ADDRESS","label":"Address","helper_text":"","type":"address","required":false,"audience_field_name":"Address","enabled":false,"order":null,"field_type":"merge","merge_id":3,"countries":{"2":"Albania","3":"Algeria","4":"Andorra","5":"Angola","6":"Argentina","7":"Armenia","8":"Australia","9":"Austria","10":"Azerbaijan","11":"Bahamas","12":"Bahrain","13":"Bangladesh","14":"Barbados","15":"Belarus","16":"Belgium","17":"Belize","18":"Benin","19":"Bermuda","20":"Bhutan","21":"Bolivia","22":"Bosnia and Herzegovina","23":"Botswana","24":"Brazil","25":"Bulgaria","26":"Burkina Faso","27":"Burundi","28":"Cambodia","29":"Cameroon","30":"Canada","31":"Cape Verde","32":"Cayman Islands","33":"Central African Republic","34":"Chad","35":"Chile","36":"China","37":"Colombia","38":"Congo","40":"Croatia","41":"Cyprus","42":"Czech Republic","43":"Denmark","44":"Djibouti","45":"Ecuador","46":"Egypt","47":"El Salvador","48":"Equatorial Guinea","49":"Eritrea","50":"Estonia","51":"Ethiopia","52":"Fiji","53":"Finland","54":"France","56":"Gabon","57":"Gambia","58":"Georgia","59":"Germany","60":"Ghana","61":"Greece","62":"Guam","63":"Guinea","64":"Guinea-Bissau","65":"Guyana","66":"Honduras","67":"Hong Kong","68":"Hungary","69":"Iceland","70":"India","71":"Indonesia","74":"Ireland","75":"Israel","76":"Italy","78":"Japan","79":"Jordan","80":"Kazakhstan","81":"Kenya","82":"Kuwait","83":"Kyrgyzstan","84":"Lao People's Democratic Republic","85":"Latvia","86":"Lebanon","87":"Lesotho","88":"Liberia","90":"Liechtenstein","91":"Lithuania","92":"Luxembourg","93":"Macedonia","94":"Madagascar","95":"Malawi","96":"Malaysia","97":"Maldives","98":"Mali","99":"Malta","100":"Mauritania","101":"Mexico","102":"Moldova","103":"Monaco","104":"Mongolia","105":"Morocco","106":"Mozambique","107":"Namibia","108":"Nepal","109":"Netherlands","110":"Netherlands Antilles","111":"New Zealand","112":"Nicaragua","113":"Niger","114":"Nigeria","116":"Norway","117":"Oman","118":"Pakistan","119":"Panama","120":"Paraguay","121":"Peru","122":"Philippines","123":"Poland","124":"Portugal","126":"Qatar","127":"Reunion","128":"Romania","129":"Russia","130":"Rwanda","132":"Samoa (Independent)","133":"Saudi Arabia","134":"Senegal","135":"Seychelles","136":"Sierra Leone","137":"Singapore","138":"Slovakia","139":"Slovenia","140":"Somalia","141":"South Africa","142":"South Korea","143":"Spain","144":"Sri Lanka","146":"Suriname","147":"Swaziland","148":"Sweden","149":"Switzerland","152":"Taiwan","153":"Tanzania","154":"Thailand","155":"Togo","156":"Tunisia","157":"Turkiye","158":"Turkmenistan","159":"Uganda","161":"Ukraine","162":"United Arab Emirates","163":"Uruguay","164":"USA","165":"Uzbekistan","166":"Vatican City State (Holy See)","167":"Venezuela","168":"Vietnam","169":"Virgin Islands (British)","170":"Yemen","173":"Zambia","174":"Zimbabwe","175":"Antigua And Barbuda","176":"Anguilla","178":"American Samoa","179":"Aruba","180":"Brunei Darussalam","181":"Bouvet Island","183":"Cook Islands","185":"Christmas Island","187":"Dominican Republic","188":"Western Sahara","189":"Falkland Islands","191":"Faroe Islands","192":"Grenada","193":"French Guiana","194":"Gibraltar","195":"Greenland","196":"Guadeloupe","198":"Guatemala","200":"Haiti","202":"Jamaica","203":"Kiribati","204":"Comoros","205":"Saint Kitts and Nevis","206":"Saint Lucia","207":"Marshall Islands","208":"Macau","210":"Martinique","212":"Mauritius","213":"New Caledonia","214":"Norfolk Island","215":"Nauru","217":"Niue","219":"Papua New Guinea","221":"Pitcairn","222":"Palau","223":"Solomon Islands","225":"Svalbard and Jan Mayen Islands","227":"San Marino","232":"Tonga","233":"Timor-Leste","234":"Trinidad and Tobago","235":"Tuvalu","237":"Saint Vincent and the Grenadines","238":"Virgin Islands (U.S.)","239":"Vanuatu","241":"Mayotte","242":"Myanmar","255":"Sao Tome and Principe","257":"South Georgia and the South Sandwich Islands","260":"Tajikistan","262":"United Kingdom","268":"Costa Rica","270":"Guernsey","272":"North Korea","274":"Afghanistan","275":"Cote D'Ivoire","276":"Cuba","277":"French Polynesia","278":"Iran","279":"Iraq","281":"Libya","282":"Palestine","285":"Syria","286":"Aaland Islands","287":"Turks & Caicos Islands","288":"Jersey  (Channel Islands)","289":"Dominica","290":"Montenegro","293":"Sudan","294":"Montserrat","298":"Curacao","302":"Sint Maarten","311":"South Sudan","315":"Republic of Kosovo","318":"Congo, Democratic Republic of the","323":"Isle of Man","324":"Saint Martin","325":"Bonaire, Saint Eustatius and Saba","326":"Serbia"},"defaultcountry":164},"PHONE":{"name":"PHONE","label":"Phone Number","helper_text":"","type":"phone","required":false,"audience_field_name":"Phone Number","phoneformat":"","enabled":false,"order":null,"field_type":"merge","merge_id":4},"BIRTHDAY":{"name":"BIRTHDAY","label":"Birthday","helper_text":"","type":"birthday","required":false,"audience_field_name":"Birthday","dateformat":"MM/DD","enabled":false,"order":null,"field_type":"merge","merge_id":5},"COMPANY":{"name":"COMPANY","label":"Company","helper_text":"","type":"text","required":false,"audience_field_name":"Company","enabled":false,"order":null,"field_type":"merge","merge_id":6}}).find(function(f) { return f.name === fieldName && f.type === 'smsphone'; });
                                                                                                                                 var isRequired = smsField ? smsField.required : false;
                                                                                                                                 var shouldAppendCountryCode = smsNotRequiredRemoveCountryCodeEnabled ? isRequired : true;

                                                                                                                                 var phoneInput = document.querySelector('#mce-' + fieldName);
                                                                                                                                 if (phoneInput && defaultProgram.countryCallingCode && shouldAppendCountryCode) {
                                                                                                                                   phoneInput.value = defaultProgram.countryCallingCode;
                                                                                                                                 }



                                                                                                                                 displayFlag?.addEventListener('click', function(e) {
                                                                                                                                   dropdown.focus();
                                                                                                                                 });


                                                                                                                                 dropdown?.addEventListener('change', function() {
                                                                                                                                   const selectedCountry = this.value;

                                                                                                                                   if (!selectedCountry || typeof selectedCountry !== 'string') {
                                                                                                                                     return;
                                                                                                                                   }

                                                                                                                                   const flagSpan = displayFlag?.querySelector('#flag-emoji-' + fieldName);
                                                                                                                                   if (flagSpan) {
                                                                                                                                     flagSpan.textContent = getCountryUnicodeFlag(selectedCountry);
                                                                                                                                     flagSpan.setAttribute('aria-label', sanitizeHtml(selectedCountry) + ' flag');
                                                                                                                                   }


                                                                                                                                   const selectedProgram = window.MC?.smsPhoneData?.programs.find(function(program) {
                                                                                                                                     return program && program.countryCode === selectedCountry;
                                                                                                                                   });

                                                                                                                                   var smsNotRequiredRemoveCountryCodeEnabled = true;
                                                                                                                                   var smsField = Object.values({"EMAIL":{"name":"EMAIL","label":"Email Address","helper_text":"","type":"email","required":true,"audience_field_name":"Email Address","merge_id":0,"help_text_enabled":false,"enabled":true,"order":"0","field_type":"merge"},"FNAME":{"name":"FNAME","label":"First Name","helper_text":"","type":"text","required":false,"audience_field_name":"First Name","enabled":false,"order":null,"field_type":"merge","merge_id":1},"LNAME":{"name":"LNAME","label":"Last Name","helper_text":"","type":"text","required":false,"audience_field_name":"Last Name","enabled":false,"order":null,"field_type":"merge","merge_id":2},"ADDRESS":{"name":"ADDRESS","label":"Address","helper_text":"","type":"address","required":false,"audience_field_name":"Address","enabled":false,"order":null,"field_type":"merge","merge_id":3,"countries":{"2":"Albania","3":"Algeria","4":"Andorra","5":"Angola","6":"Argentina","7":"Armenia","8":"Australia","9":"Austria","10":"Azerbaijan","11":"Bahamas","12":"Bahrain","13":"Bangladesh","14":"Barbados","15":"Belarus","16":"Belgium","17":"Belize","18":"Benin","19":"Bermuda","20":"Bhutan","21":"Bolivia","22":"Bosnia and Herzegovina","23":"Botswana","24":"Brazil","25":"Bulgaria","26":"Burkina Faso","27":"Burundi","28":"Cambodia","29":"Cameroon","30":"Canada","31":"Cape Verde","32":"Cayman Islands","33":"Central African Republic","34":"Chad","35":"Chile","36":"China","37":"Colombia","38":"Congo","40":"Croatia","41":"Cyprus","42":"Czech Republic","43":"Denmark","44":"Djibouti","45":"Ecuador","46":"Egypt","47":"El Salvador","48":"Equatorial Guinea","49":"Eritrea","50":"Estonia","51":"Ethiopia","52":"Fiji","53":"Finland","54":"France","56":"Gabon","57":"Gambia","58":"Georgia","59":"Germany","60":"Ghana","61":"Greece","62":"Guam","63":"Guinea","64":"Guinea-Bissau","65":"Guyana","66":"Honduras","67":"Hong Kong","68":"Hungary","69":"Iceland","70":"India","71":"Indonesia","74":"Ireland","75":"Israel","76":"Italy","78":"Japan","79":"Jordan","80":"Kazakhstan","81":"Kenya","82":"Kuwait","83":"Kyrgyzstan","84":"Lao People's Democratic Republic","85":"Latvia","86":"Lebanon","87":"Lesotho","88":"Liberia","90":"Liechtenstein","91":"Lithuania","92":"Luxembourg","93":"Macedonia","94":"Madagascar","95":"Malawi","96":"Malaysia","97":"Maldives","98":"Mali","99":"Malta","100":"Mauritania","101":"Mexico","102":"Moldova","103":"Monaco","104":"Mongolia","105":"Morocco","106":"Mozambique","107":"Namibia","108":"Nepal","109":"Netherlands","110":"Netherlands Antilles","111":"New Zealand","112":"Nicaragua","113":"Niger","114":"Nigeria","116":"Norway","117":"Oman","118":"Pakistan","119":"Panama","120":"Paraguay","121":"Peru","122":"Philippines","123":"Poland","124":"Portugal","126":"Qatar","127":"Reunion","128":"Romania","129":"Russia","130":"Rwanda","132":"Samoa (Independent)","133":"Saudi Arabia","134":"Senegal","135":"Seychelles","136":"Sierra Leone","137":"Singapore","138":"Slovakia","139":"Slovenia","140":"Somalia","141":"South Africa","142":"South Korea","143":"Spain","144":"Sri Lanka","146":"Suriname","147":"Swaziland","148":"Sweden","149":"Switzerland","152":"Taiwan","153":"Tanzania","154":"Thailand","155":"Togo","156":"Tunisia","157":"Turkiye","158":"Turkmenistan","159":"Uganda","161":"Ukraine","162":"United Arab Emirates","163":"Uruguay","164":"USA","165":"Uzbekistan","166":"Vatican City State (Holy See)","167":"Venezuela","168":"Vietnam","169":"Virgin Islands (British)","170":"Yemen","173":"Zambia","174":"Zimbabwe","175":"Antigua And Barbuda","176":"Anguilla","178":"American Samoa","179":"Aruba","180":"Brunei Darussalam","181":"Bouvet Island","183":"Cook Islands","185":"Christmas Island","187":"Dominican Republic","188":"Western Sahara","189":"Falkland Islands","191":"Faroe Islands","192":"Grenada","193":"French Guiana","194":"Gibraltar","195":"Greenland","196":"Guadeloupe","198":"Guatemala","200":"Haiti","202":"Jamaica","203":"Kiribati","204":"Comoros","205":"Saint Kitts and Nevis","206":"Saint Lucia","207":"Marshall Islands","208":"Macau","210":"Martinique","212":"Mauritius","213":"New Caledonia","214":"Norfolk Island","215":"Nauru","217":"Niue","219":"Papua New Guinea","221":"Pitcairn","222":"Palau","223":"Solomon Islands","225":"Svalbard and Jan Mayen Islands","227":"San Marino","232":"Tonga","233":"Timor-Leste","234":"Trinidad and Tobago","235":"Tuvalu","237":"Saint Vincent and the Grenadines","238":"Virgin Islands (U.S.)","239":"Vanuatu","241":"Mayotte","242":"Myanmar","255":"Sao Tome and Principe","257":"South Georgia and the South Sandwich Islands","260":"Tajikistan","262":"United Kingdom","268":"Costa Rica","270":"Guernsey","272":"North Korea","274":"Afghanistan","275":"Cote D'Ivoire","276":"Cuba","277":"French Polynesia","278":"Iran","279":"Iraq","281":"Libya","282":"Palestine","285":"Syria","286":"Aaland Islands","287":"Turks & Caicos Islands","288":"Jersey  (Channel Islands)","289":"Dominica","290":"Montenegro","293":"Sudan","294":"Montserrat","298":"Curacao","302":"Sint Maarten","311":"South Sudan","315":"Republic of Kosovo","318":"Congo, Democratic Republic of the","323":"Isle of Man","324":"Saint Martin","325":"Bonaire, Saint Eustatius and Saba","326":"Serbia"},"defaultcountry":164},"PHONE":{"name":"PHONE","label":"Phone Number","helper_text":"","type":"phone","required":false,"audience_field_name":"Phone Number","phoneformat":"","enabled":false,"order":null,"field_type":"merge","merge_id":4},"BIRTHDAY":{"name":"BIRTHDAY","label":"Birthday","helper_text":"","type":"birthday","required":false,"audience_field_name":"Birthday","dateformat":"MM/DD","enabled":false,"order":null,"field_type":"merge","merge_id":5},"COMPANY":{"name":"COMPANY","label":"Company","helper_text":"","type":"text","required":false,"audience_field_name":"Company","enabled":false,"order":null,"field_type":"merge","merge_id":6}}).find(function(f) { return f.name === fieldName && f.type === 'smsphone'; });
                                                                                                                                   var isRequired = smsField ? smsField.required : false;
                                                                                                                                   var shouldAppendCountryCode = smsNotRequiredRemoveCountryCodeEnabled ? isRequired : true;

                                                                                                                                   var phoneInput = document.querySelector('#mce-' + fieldName);
                                                                                                                                   if (phoneInput && selectedProgram.countryCallingCode && shouldAppendCountryCode) {
                                                                                                                                     phoneInput.value = selectedProgram.countryCallingCode;
                                                                                                                                   }


                                                                                                                                   updateSmsLegalText(selectedCountry, fieldName);
                                                                                                                                   updatePlaceholder(selectedCountry, fieldName);
                                                                                                                                   updateCountryCodeInstruction(selectedCountry, fieldName);
                                                                                                                                 });
                                                                                                                               }

                                                                                                                               document.addEventListener('DOMContentLoaded', function() {
                                                                                                                                 const smsPhoneFields = document.querySelectorAll('[id^="country-select-"]');

                                                                                                                                 smsPhoneFields.forEach(function(dropdown) {
                                                                                                                                   const fieldName = dropdown?.id.replace('country-select-', '');
                                                                                                                                   initializeSmsPhoneDropdown(fieldName);
                                                                                                                                 });
                                                                                                                               });
            </script>
        </div>

    </div>
</div>
<div class="modal fade" id="videoReviewModal" tabindex="-1" aria-labelledby="videoReviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="swiper" id="videoSwiper">
    <div class="swiper-wrapper">
        
        @if (ViewBag.VideoList != null)
        {
            foreach (var video in (List<Video>)ViewBag.VideoList)
            {
                <div class="swiper-slide">
                    <video class="video-player-slide" 
                           src="@video.VideoUrl" 
                           preload="metadata" 
                           loop 
                           playsinline 
                           muted>
                        Trình duyệt của bạn không hỗ trợ thẻ video.
                    </video>
                    
                    @if (video.SanPham != null)
                    {
                        <div class="video-slide-info">
                            <h4>@video.TieuDe</h4>
                            <a href="javascript:void(0);" 
                               class="product-link btn-show-product" 
                               data-product-id="@video.MaSP">
                                <i class="fa fa-tag"></i> Xem sản phẩm: @video.SanPham.TenSP
                            </a>
                        </div>

                        <div class="video-product-details" id="product-details-@video.MaSP">
                            <div class="details-content">
                                <button type="button" class="btn-close-details">&times;</button>
                                
                                <div class="product-info-header">
                                    <img src="@(video.SanPham.ImageURL ?? "/images/no-image.png")" alt="@video.SanPham.TenSP" class="product-details-img"/>
                                    <div class="product-info-price">
                                        <span class="price">@video.SanPham.DonGia.ToString("N0") đ</span>
                                        </div>
                                </div>
                                <p class="product-details-name">@video.SanPham.TenSP</p>
                                
                                <button class="btn btn-add-to-cart" data-product-id="@video.MaSP">
                                    <i class="icon-bag2"></i> Thêm vào giỏ hàng
                                </button>
                                
                                <a href="@Url.Action("Details", "SanPham", new { id = video.MaSP })" class="btn btn-full-details" target="_blank">
                                    Xem chi tiết đầy đủ
                                </a>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="video-slide-info">
                            <h4>@video.TieuDe</h4>
                        </div>
                    }
                </div>
            }
        }
        
    </div>
</div>
            </div>
        </div>
    </div>
</div>